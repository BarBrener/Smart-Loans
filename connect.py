from web3 import Web3
import json

# Connect to Ganache (or any Ethereum node like Infura)
w3 = Web3(Web3.HTTPProvider("http://127.0.0.1:7545"))  # Change this to your provider URL
w3.is_connected()

# Set the default account (sender account)
w3.eth.default_account = w3.eth.accounts[0]

# Load the ABI
with open("TransferContract_abi.json", "r") as abi_file:
    abi = json.load(abi_file)

# Bytecode from the previous step
bytecode = "60806040523480156200001157600080fd5b5060405162000c0938038062000c098339818101604052810190620000379190620001d2565b81600090805190602001906200004f92919062000099565b5080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050620003ab565b828054620000a790620002fd565b90600052602060002090601f016020900481019282620000cb576000855562000117565b82601f10620000e657805160ff191683800117855562000117565b8280016001018555821562000117579182015b8281111562000116578251825591602001919060010190620000f9565b5b5090506200012691906200012a565b5090565b5b80821115620001455760008160009055506001016200012b565b5090565b6000620001606200015a8462000260565b6200022c565b9050828152602081018484840111156200017957600080fd5b62000186848285620002c7565b509392505050565b6000815190506200019f8162000391565b92915050565b600082601f830112620001b757600080fd5b8151620001c984826020860162000149565b91505092915050565b60008060408385031215620001e657600080fd5b600083015167ffffffffffffffff8111156200020157600080fd5b6200020f85828601620001a5565b925050602062000222858286016200018e565b9150509250929050565b6000604051905081810181811067ffffffffffffffff8211171562000256576200025562000362565b5b8060405250919050565b600067ffffffffffffffff8211156200027e576200027d62000362565b5b601f19601f8301169050602081019050919050565b6000620002a082620002a7565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60005b83811015620002e7578082015181840152602081019050620002ca565b83811115620002f7576000848401525b50505050565b600060028204905060018216806200031657607f821691505b602082108114156200032d576200032c62000333565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6200039c8162000293565b8114620003a857600080fd5b50565b61084e80620003bb6000396000f3fe6080604052600436106100705760003560e01c80639000b9341161004e5780639000b934146100f6578063c47f002714610121578063e28d717b1461014a578063e30081a01461015457610070565b806306fdde031461007557806317d7de7c146100a05780638f63640e146100cb575b600080fd5b34801561008157600080fd5b5061008a61017d565b604051610097919061062d565b60405180910390f35b3480156100ac57600080fd5b506100b561020b565b6040516100c2919061062d565b60405180910390f35b3480156100d757600080fd5b506100e061029d565b6040516100ed9190610612565b60405180910390f35b34801561010257600080fd5b5061010b6102c3565b6040516101189190610612565b60405180910390f35b34801561012d57600080fd5b5061014860048036038101906101439190610549565b6102ed565b005b610152610307565b005b34801561016057600080fd5b5061017b60048036038101906101769190610520565b6103bc565b005b6000805461018a90610760565b80601f01602080910402602001604051908101604052809291908181526020018280546101b690610760565b80156102035780601f106101d857610100808354040283529160200191610203565b820191906000526020600020905b8154815290600101906020018083116101e657829003601f168201915b505050505081565b60606000805461021a90610760565b80601f016020809104026020016040519081016040528092919081815260200182805461024690610760565b80156102935780601f1061026857610100808354040283529160200191610293565b820191906000526020600020905b81548152906001019060200180831161027657829003601f168201915b5050505050905090565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b8060009080519060200190610303929190610400565b5050565b670de0b6b3a76400003414610351576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103489061064f565b60405180910390fd5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc349081150290604051600060405180830381858888f193505050501580156103b9573d6000803e3d6000fd5b50565b80600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b82805461040c90610760565b90600052602060002090601f01602090048101928261042e5760008555610475565b82601f1061044757805160ff1916838001178555610475565b82800160010185558215610475579182015b82811115610474578251825591602001919060010190610459565b5b5090506104829190610486565b5090565b5b8082111561049f576000816000905550600101610487565b5090565b60006104b66104b1846106a0565b61066f565b9050828152602081018484840111156104ce57600080fd5b6104d984828561071e565b509392505050565b6000813590506104f081610801565b92915050565b600082601f83011261050757600080fd5b81356105178482602086016104a3565b91505092915050565b60006020828403121561053257600080fd5b6000610540848285016104e1565b91505092915050565b60006020828403121561055b57600080fd5b600082013567ffffffffffffffff81111561057557600080fd5b610581848285016104f6565b91505092915050565b610593816106ec565b82525050565b60006105a4826106d0565b6105ae81856106db565b93506105be81856020860161072d565b6105c7816107f0565b840191505092915050565b60006105df601c836106db565b91507f596f75206d7573742073656e642065786163746c792031204554482e000000006000830152602082019050919050565b6000602082019050610627600083018461058a565b92915050565b600060208201905081810360008301526106478184610599565b905092915050565b60006020820190508181036000830152610668816105d2565b9050919050565b6000604051905081810181811067ffffffffffffffff82111715610696576106956107c1565b5b8060405250919050565b600067ffffffffffffffff8211156106bb576106ba6107c1565b5b601f19601f8301169050602081019050919050565b600081519050919050565b600082825260208201905092915050565b60006106f7826106fe565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b82818337600083830152505050565b60005b8381101561074b578082015181840152602081019050610730565b8381111561075a576000848401525b50505050565b6000600282049050600182168061077857607f821691505b6020821081141561078c5761078b610792565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f8301169050919050565b61080a816106ec565b811461081557600080fd5b5056fea2646970667358221220ed63a1f5b2b1870418bee6f3c7dfc26a577a8500399717b7fd0a56a63b6aa07264736f6c63430008000033"  # Replace with actual bytecode obtained

# Deploy the contract
TransferContract = w3.eth.contract(abi=abi, bytecode=bytecode)

# Set the initial name and address
initial_name = "MyContract"
initial_address = w3.eth.accounts[1]  # Use another address from Ganache or your network

# Build the transaction
tx_hash = TransferContract.constructor(initial_name, initial_address).transact()

# Wait for the transaction receipt (deployment confirmation)
tx_receipt = w3.eth.wait_for_transaction_receipt(tx_hash)
contract_address = tx_receipt.contractAddress
print(f"Contract deployed at address: {contract_address}")

# Create an instance of the deployed contract
contract_instance = w3.eth.contract(address=contract_address, abi=abi)

# Retrieve the stored name and address
stored_name = contract_instance.functions.getName().call()
stored_address = contract_instance.functions.getStoredAddress().call()
print(f"Stored name: {stored_name}, Stored address: {stored_address}")

# Transfer 1 ETH to the stored address
# The contract requires 1 ETH to be sent in this call
tx_hash = contract_instance.functions.transferETH().transact({'value': w3.to_wei(1, 'ether')})

# Wait for the transaction to be mined
tx_receipt = w3.eth.wait_for_transaction_receipt(tx_hash)
print(f"Transaction successful with hash: {tx_receipt.transactionHash.hex()}")